var CM=MELON.WEBSVC.CM||(MELON.WEBSVC.CM={});function cmCheckedLog(a){if(typeof console!=="undefined"){console.log(a)}else{}}(function(){var contsIdList;var DestinationIP="http://127.0.0.1:46286";MELON.WEBSVC.CM.UTILS={};MELON.WEBSVC.CM.CONT={getDomainMelon:function(){var domainVar=location.host;if(domainVar=="decop.melon.com"||domainVar==="vod.melon.com"||domainVar==="live.melon.com"){domainVar="www.melon.com"}else{if(domainVar=="localhost"){domainVar="localhost:8080"}}return"https://"+domainVar},getContsIdListFromAlbumId:function(tmpAlbumId){var albumIdUrl="/cm/download/song/listContsIdFromAlbumId.json";$.ajax({dataType:"json",async:false,url:albumIdUrl,data:{albumId:tmpAlbumId},success:function(data){contsIdList=data.LIST}})},goBuyProduct:function(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll){var progYn="Y";if(progYn==="Y"){var isMac=(navigator.userAgent.indexOf("Mac")>0);if(isMac){MELON.WEBSVC.CM.CONT.macCase(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}else{var isEdge=(navigator.userAgent.indexOf("Edge")>0);var browser=MELON.WEBSVC.POC.play.browser();var browserType="";if(isEdge||browser==="chrome"||browser==="safari"||browser==="firefox"){browserType="UNITY"}else{if(browser==="ie"){browserType="OCX"}else{browserType="OLDPLUGIN"}}if(browserType==="UNITY"){MELON.WEBSVC.CM.CONT.goBuyProductUnity(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}else{MELON.WEBSVC.CM.CONT.goBuyProductPrevVersion(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}}}},macCase:function(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll){var realBuyType=$("#realBuyType").val();if(realBuyType==undefined){realBuyType=0}else{realBuyType=parseInt(realBuyType)}var getInfoForMac=function(realBuyType,contsId){var tmpBuyPage;var tmpItemCodec;var tmpBitrate=192;switch(parseInt(realBuyType)){case 3:tmpBuyPage=13;tmpItemCodec=0;break;case 5:if(contsType==="3B0001"){tmpBuyPage=4;tmpItemCodec=0}else{tmpBuyPage=3;tmpItemCodec=$("input[value="+contsId+"]").parents("tr").find("td div.wrap.pd_none").not(".left").not(".right").text().trim();if(tmpItemCodec==="MP3"){tmpItemCodec=0}else{if(tmpItemCodec==="DCF"){tmpItemCodec=1}}}break;case 105:tmpBuyPage=21;tmpItemCodec=4;tmpBitrate=0;break;case 115:tmpBuyPage=22;tmpItemCodec=5;tmpBitrate=0;break;case 215:tmpBuyPage=23;tmpBitrate=0;var targtBit=$("#"+contsId+"-bit").data("bit");if(targtBit.indexOf("16")>0){tmpItemCodec=4}else{if(targtBit.indexOf("24")>0){tmpItemCodec=5}}break;default:break}var rtn={buyPage:tmpBuyPage,itemCodec:tmpItemCodec,bitRate:tmpBitrate};return rtn};var isSupport=true;if("3C0002"===contsType){isSupport=false;alert("Mac OS에서는 뮤직비디오 다운로드 서비스를 제공하지 않습니다.\r\nWindows나 모바일 멜론 앱을 이용해주세요.")}else{if("3C0001"===contsType&&(parseInt(buyType)===100||parseInt(buyType)===110)&&realBuyType!==105&&realBuyType!==115&&realBuyType!==215){if(contsId===undefined||contsId===""){isSupport=false;alert("Mac OS에서는 FLAC 다운로드 서비스를 제공하지 않습니다.\r\nWindows나 모바일 멜론 앱을 이용해주세요.")}else{buyType=0}}else{if("3B0001"===contsType&&(parseInt(buyType)===100||parseInt(buyType)===110)&&realBuyType!==105&&realBuyType!==115&&realBuyType!==215){isSupport=false;alert("Mac OS에서는 FLAC 다운로드 서비스를 제공하지 않습니다.\r\nWindows나 모바일 멜론 앱을 이용해주세요.")}}}if(isSupport){var ref="";var tmpIframeDn=$("#tmpIframeDn");if(tmpIframeDn.length==0){tmpIframeDn='<iframe id="tmpIframeDn" name="tmpIframeDn" style="display:none" width="0" height="0" src="about:blank"/>';$("body").append(tmpIframeDn)}if(typeof api==="undefined"){if(document.getElementById("ref")!=null){ref=document.getElementById("ref").value}if(ref!=null&&ref!=""){api=new MPAPI({target:$("#tmpIframeDn"),ref:ref})}else{api=new MPAPI({target:$("#tmpIframeDn")})}}var macVer=api.macOSVersion();if(macVer!==undefined||macVer!=="undefined"||macVer!==""){var arrVer=macVer.split(".");if(parseInt(arrVer[0])>10){}else{if(arrVer.length>=2&&parseInt(arrVer[0])===10&&parseInt(arrVer[1])>=10){}else{alert("macOS에서는 Mac용 멜론 플레이어를 이용하여 음악/어학을 감상하고 다운로드 하실 수 있습니다.\nMac용 멜론 플레이어는 OS 버전 10.10부터 설치 가능합니다.\n사용 중인 OS 버전을 확인해주세요.");return}}}var itemFlg;switch(contsType){case"3C0001":itemFlg=1;break;case"3B0001":itemFlg=2;break;case"3C0003":itemFlg=4;break;default:itemFlg=1;break}var dnList=[];var isOk=false;var isRdl=false;if(typeof contsId!=="undefined"&&$.isNumeric(contsId)){isOk=true;if(realBuyType!==0&&realBuyType!=undefined&&realBuyType!==""){isRdl=true;var getInfo=getInfoForMac(realBuyType,contsId);var product=0;var statisticid="";dnList.push({BUYPAGE:getInfo.buyPage,ITEMCODEC:getInfo.itemCodec,ITEMFLAG:itemFlg,ITEMID:contsId,PRODUCT:product,BITRATE:getInfo.bitRate,STATISTICID:statisticid,MENUID:menuId,REF:ref})}else{dnList.push({ITEMFLAG:itemFlg,ITEMID:contsId,MENUID:menuId,REF:ref})}}else{var dnTargtList=$("form[name="+formName+"] input[name="+paramsName+"]:checked");if(dnTargtList.length>0){isOk=true;if(realBuyType!==0&&realBuyType!=undefined&&realBuyType!==""){isRdl=true;dnTargtList.each(function(){var getContsId=this.value;var getInfo=getInfoForMac(realBuyType,getContsId);var product=0;var bitrate=192;var statisticid="";dnList.push({ITEMFLAG:itemFlg,ITEMID:getContsId,BUYPAGE:getInfo.buyPage,ITEMCODEC:getInfo.itemCodec,PRODUCT:product,BITRATE:getInfo.bitRate,STATISTICID:statisticid,MENUID:menuId,REF:ref})})}else{dnTargtList.each(function(){dnList.push({ITEMFLAG:itemFlg,ITEMID:this.value,MENUID:menuId,REF:ref})})}}}if(isOk){MELON.WEBSVC.CM.CONT.callMacPlayer(isOk,dnList,isRdl)}}},callMacPlayer:function(isOk,dnList,isRdl){if(isOk){if(isRdl){var menuId="";var ref="";for(var x=0;x<dnList.length;x++){var ele=dnList[x];if(menuId==""){menuId=ele.MENUID}if(ref==""){ref=ele.REF}if(menuId!==""&&ref!==""){break}}var isHifiMenu=MELON.WEBSVC.CM.CONT.isHifiMenu(menuId);var objMap={LIST:dnList};var scheme="melonplayer://redownload?ref="+ref+"&menuid="+menuId+"&list="+encodeURIComponent(JSON.stringify(objMap))+"&isHifiMenu="+isHifiMenu+"&userId="+encodeURIComponent(getMemberId())+"&memberKey="+getMemberKey()+"&token="+encodeURIComponent(getMemberToken())+"&mac="+encodeURIComponent(getMACHeaderCookie());$("#tmpIframeDn").prop("src",scheme)}else{var cid="";var menuId="";var ref="";var cflag="";for(var x=0;x<dnList.length;x++){var ele=dnList[x];cid+=ele.ITEMID+",";if(menuId==""){menuId=ele.MENUID}if(ref==""){ref=ele.REF}if(cflag==""){cflag=ele.ITEMFLAG}}cid=cid.substring(0,cid.length-1);var isHifiMenu=MELON.WEBSVC.CM.CONT.isHifiMenu(menuId);var scheme="melonplayer://download?ref="+ref+"&menuId="+menuId+"&cid="+cid+"&cflag="+cflag+"&isHifiMenu="+isHifiMenu+"&userId="+encodeURIComponent(getMemberId())+"&memberKey="+getMemberKey()+"&token="+encodeURIComponent(getMemberToken())+"&mac="+encodeURIComponent(getMACHeaderCookie());$("#tmpIframeDn").prop("src",scheme)}if(typeof macNotice!=="undefined"){if(typeof macNotice!=="undefined"){macNotice.open()}else{if($("#macplayer_popup_comm").length==0){var macNoticeHtml="";macNoticeHtml+="<div id='macplayer_popup_comm' class='layer_popup'>";macNoticeHtml+="	<h1 class='title'>안내</h1>";macNoticeHtml+="	<div class='cntt'>";macNoticeHtml+="		<p class='text_notice'>MAC OS에서는 MAC용 멜론 플레이어를 통해 음악을 <br />감상할 수 있습니다. 멜론 플레이어가 설치 되어있지 <br />않은 경우 App Store에서 설치해 주세요.</p>";macNoticeHtml+="		<ul class='button_group'>";macNoticeHtml+="			<li><a href='https://itunes.apple.com/us/app/%EB%A9%9C%EB%A1%A0-melon/id1236050766?l=ko&ls=1&mt=12' target='_blank'>앱스토어 바로가기</a></li>";macNoticeHtml+="			<li><a href='https://www.melon.com/customer/serviceintro/multi_pc_web.htm' target='_blank'>설치 방법 보기</a></li>";macNoticeHtml+="		</ul>";macNoticeHtml+="	</div>";macNoticeHtml+="	<button type='button' title='로그인 닫기' class='btn_close d_close'><span>닫기</span></button>";macNoticeHtml+="	<span class='shadow'></span>";macNoticeHtml+="</div>";$("body").append(macNoticeHtml)}var macNotice2={open:function(){$("#macplayer_popup_comm").modal("show");this.hide()},hide:function(){setInterval(function(){$("#macplayer_popup_comm").modal("hide")},10000)}};macNotice2.open()}}}else{if(contsType=="3C0001"){alert("곡을 선택해 주세요.")}else{if(contsType=="3C0003"){alert("다운받을 강의를 선택해 주세요.")}else{if(contsType=="3B0001"){alert("앨범을 선택해 주세요.")}else{alert("다운받을 컨텐츠를 선택해 주세요.")}}}}},isHifiMenu:function(getMenuId){var isHiFiMenu=0;try{if(typeof getMenuId!="undefined"){if(getMenuId.length>2){if("89"==getMenuId.substr(0,2)||"27220201"==getMenuId||"27220101"==getMenuId){isHiFiMenu=1}}}}catch(e){}return isHiFiMenu},goBuyProductUnity:function(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll){var fromMPS=getCookie("MPS");if(buyType!="100"&&buyType!="110"&&fromMPS!=null&&fromMPS.indexOf("MELONPLAYER")>=0){MELON.WEBSVC.CM.CONT.goBuyProductNext(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}else{var cnt=0;$.fn.chkNotifyInstalled();var retry=setInterval(function(){if($.isNotifyInstalled){MELON.WEBSVC.CM.CONT.goBuyProductNext(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}var localCnt=0;localCnt++;if(localCnt==5||$.isNotifyInstalled){clearInterval(retry);cmCheckedLog("retry cnt:"+localCnt+"/$.isNotifyInstalled:"+$.isNotifyInstalled);if(!$.isNotifyInstalled){}}},1000)}},goBuyProductPrevVersion:function(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll){var isPlugInSetup=false;var fromMPS=getCookie("MPS");var idx=0;var domainVar=MELON.WEBSVC.CM.CONT.getDomainMelon();var cnt=0;if(formName!=""&&formName!=undefined){cnt=$("form[name="+formName+"] input:checkbox[name="+paramsName+"]:checked").length}else{formName="tmpFormByComm20140221";var tmpFormByComm20140221=$("#tmpFormByComm20140221");if(tmpFormByComm20140221.length==0){tmpFormByComm20140221=document.createElement("form");tmpFormByComm20140221.name="tmpFormByComm20140221";tmpFormByComm20140221.id="tmpFormByComm20140221";tmpFormByComm20140221.method="POST";$("body").append(tmpFormByComm20140221)}else{tmpFormByComm20140221.innerHTML=""}cnt=$("input:checkbox[name="+paramsName+"]:checked").length}if(buyType=="0"||buyType=="100"||buyType=="110"){if(cnt==0&&contsId==""){if(contsType=="3C0001"){alert("곡을 선택해 주세요.")}else{if(contsType=="3C0003"){alert("다운받을 강의를 선택해 주세요.")}else{if(contsType=="3B0001"){alert("앨범을 선택해 주세요.")}else{alert("다운받을 컨텐츠를 선택해 주세요.")}}}return}}else{if(buyType=="2"||buyType=="3"||buyType=="4"||buyType=="5"){if(cnt==0&&contsId==""){if(contsType=="3C0001"){alert("곡을 선택해 주세요.")}else{if(contsType=="3C0003"){alert("다운받을 강의를 선택해 주세요.")}else{alert("다운받을 컨텐츠를 선택해 주세요.")}}return}}}var params="?formName="+formName+"&byContsId="+contsId+"&contsType="+contsType+"&paramsName="+paramsName+"&buyType="+buyType+"&menuId="+menuId;var url="";var browser=MELON.WEBSVC.POC.play.browser();if(browser=="ie"){url=domainVar+"/cm/download/comm/updateOcx.htm"+params}else{for(var idx=0;idx<navigator.plugins.length;idx++){if(navigator.plugins[idx].name.indexOf("MelOnWebLinker")>-1){isPlugInSetup=true;break}}url="https://www.melon.com/plugin/popup/plugin_install.htm"}if((browser!="ie"&&isPlugInSetup)||MELON.WEBSVC.POC.play.chkMelonPlayerObject()){if(fromMPS!=null&&fromMPS.indexOf("MELONPLAYER")>=0){var info=new MelOnAPIHelper();var contsTypeNum="";var FLAC16bit0or1=0;var FLAC24bit0or1=0;if(parseInt(buyType)===100){FLAC16bit0or1=1}else{if(parseInt(buyType)===110){FLAC24bit0or1=1}}if(contsType=="3C0001"){contsTypeNum="1"}else{if(contsType=="3B0001"){contsTypeNum="2";if("1"===exceptAll){contsTypeNum="1";MELON.WEBSVC.CM.CONT.getContsIdListFromAlbumId(contsId)}}else{if(contsType=="3C0003"){contsTypeNum="4"}else{if(contsType=="3C0002"){contsTypeNum="21"}else{}}}}if(paramsName==""){var obj=eval(formName);if("1"===exceptAll){for(var x=0;x<contsIdList.length;x++){info.append(contsTypeNum,contsIdList[x],menuId,0,FLAC16bit0or1,FLAC24bit0or1)}}else{if(contsTypeNum=="2"){info.append(contsTypeNum,contsId,menuId,1,FLAC16bit0or1,FLAC24bit0or1)}else{info.append(contsTypeNum,contsId,menuId,0,FLAC16bit0or1,FLAC24bit0or1)}}if(contsTypeNum=="21"){MelonAPI.action("contentsDownload",info.stringify())}else{MelonAPI.action("contentsDownload",info.stringify())}}else{if(contsTypeNum=="2"){info.append(contsTypeNum,contsId,menuId,1,FLAC16bit0or1,FLAC24bit0or1);MelonAPI.action("contentsDownload",info.stringify())}else{if("1"===exceptAll){for(var x=0;x<contsIdList.length;x++){info.append(contsTypeNum,contsIdList[x],menuId,0,FLAC16bit0or1,FLAC24bit0or1)}MelonAPI.action("contentsDownload",info.stringify())}else{var obj=eval("document."+formName);if(obj==undefined){for(var j=0;j<document.forms.length;j++){if(document.forms[j].id==formName){obj=document.forms[j];break}}}if(obj!=null){for(var i=0;i<obj.elements.length;i++){if(obj.elements[i].type=="checkbox"&&obj.elements[i].name==paramsName){if(obj.elements[i].checked){info.append(contsTypeNum,obj[i].value,menuId,0,FLAC16bit0or1,FLAC24bit0or1)}}}MelonAPI.action("contentsDownload",info.stringify())}}}}}else{if(!isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd()}else{MELON.WEBSVC.CM.CONT.commDl(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}}}else{if(!isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd()}else{window.open(url,"chkOcx","width=578,height=616, scrollbars=yes")}}},goBuyProductNext:function(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll){var isPlugInSetup=false;var fromMPS=getCookie("MPS");var idx=0;var domainVar=MELON.WEBSVC.CM.CONT.getDomainMelon();var cnt=0;if(formName!=""&&formName!=undefined){cnt=$("form[name="+formName+"] input:checkbox[name="+paramsName+"]:checked").length}else{formName="tmpFormByComm20140221";var tmpFormByComm20140221=$("#tmpFormByComm20140221");if(tmpFormByComm20140221.length==0){tmpFormByComm20140221=document.createElement("form");tmpFormByComm20140221.name="tmpFormByComm20140221";tmpFormByComm20140221.id="tmpFormByComm20140221";tmpFormByComm20140221.method="POST";$("body").append(tmpFormByComm20140221)}else{tmpFormByComm20140221.innerHTML=""}cnt=$("input:checkbox[name="+paramsName+"]:checked").length}if(buyType=="0"||buyType=="100"||buyType=="110"){if(cnt==0&&contsId==""){if(contsType=="3C0001"){alert("곡을 선택해 주세요.")}else{if(contsType=="3C0003"){alert("다운받을 강의를 선택해 주세요.")}else{if(contsType=="3B0001"){alert("앨범을 선택해 주세요.")}else{alert("다운받을 컨텐츠를 선택해 주세요.")}}}return}}else{if(buyType=="2"||buyType=="3"||buyType=="4"||buyType=="5"){if(cnt==0&&contsId==""){if(contsType=="3C0001"){alert("곡을 선택해 주세요.")}else{if(contsType=="3C0003"){alert("다운받을 강의를 선택해 주세요.")}else{alert("다운받을 컨텐츠를 선택해 주세요.")}}return}}}var params="?formName="+formName+"&byContsId="+contsId+"&contsType="+contsType+"&paramsName="+paramsName+"&buyType="+buyType+"&menuId="+menuId;var url="";var browser=MELON.WEBSVC.POC.play.browser();if(browser=="ie"){url=domainVar+"/commerce/mypage/product/web/producthistory_prodList.htm"}else{for(var idx=0;idx<navigator.plugins.length;idx++){if(navigator.plugins[idx].name.indexOf("MelOnWebLinker")>-1){isPlugInSetup=true;break}}url="https://www.melon.com/commerce/mypage/product/web/producthistory_prodList.htm"}if(!isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd()}else{MELON.WEBSVC.CM.CONT.commDl(formName,contsId,contsType,paramsName,buyType,menuId,exceptAll)}},goBuyProductArr:function(arrContsId,contsType,buyType,menuId,exceptAll){var tmpCommerceContsForm=document.createElement("form");tmpCommerceContsForm.innerHTML="";var tmpInnerHtml="";var contsId="";var paramsName="";if(arrContsId!=undefined&&arrContsId.length>0){if(contsType==="3C0001"||contsType==="3C0003"){paramsName="arrContsId";for(var i=0;i<arrContsId.length;i++){tmpInnerHtml+="<input type='checkbox' name='arrContsId' value='"+arrContsId[i]+"' checked />"}}else{contsId=arrContsId[0]}tmpCommerceContsForm.name="commerceArrUniqueForm";tmpCommerceContsForm.method="POST";tmpCommerceContsForm.id="commerceArrUniqueForm";tmpCommerceContsForm.innerHTML=tmpInnerHtml;tmpCommerceContsForm.style.display="none";var tmpGetForm=$("#commerceArrUniqueForm");if(tmpGetForm.length==0){$("body").append(tmpCommerceContsForm)}else{$("#commerceArrUniqueForm").remove();$("body").append(tmpCommerceContsForm)}MELON.WEBSVC.CM.CONT.goBuyProduct("commerceArrUniqueForm",contsId,contsType,paramsName,buyType,menuId,exceptAll)}},goProduct:function(itemIds,contsType,index,menuId){MELON.WEBSVC.CM.CONT.goBuyProductArr(itemIds,contsType,0,menuId,0)},informUrl:function(formName,contsId,contsType,paramsName,buyType,menuId,params2){var domainVar=MELON.WEBSVC.CM.CONT.getDomainMelon();var flacAlbumSclasCode="";var url="";var params="?formName="+formName+"&byContsId="+contsId+"&contsType="+contsType+"&paramsName="+paramsName+"&buyType="+buyType+"&menuId="+menuId;switch(contsType){case"3C0001":url="/cm/download/song/listView.htm";break;case"3B0001":url="/cm/download/song/listAlbumView.htm";if(100==parseInt(buyType)){flacAlbumSclasCode="FG1107";if(1===parseInt(params2)){flacAlbumSclasCode="FG1106"}}else{if(110==parseInt(buyType)){flacAlbumSclasCode="FG1109";if(1===parseInt(params2)){flacAlbumSclasCode="FG1108"}}}break;case"3C0002":url="/cm/download/mv/listView.htm";break;case"3C0003":url="/cm/download/lang/listView.htm";break;default:break}if(buyType==0||buyType==10||buyType==100||buyType==110){if(buyType==0||buyType==100||buyType==110){if(contsType=="3B0001"){url=domainVar+url+"?paramsName=albumId&albumId="+contsId+"&exceptAll="+params2+"&contsType="+contsType+"&menuId="+menuId;if(flacAlbumSclasCode!=""){url+="&prodSclasCode="+flacAlbumSclasCode;if(1===parseInt(params2)){url+="&tab=BUYFLACSONG"}}}else{if(contsType==="3C0001"&&(buyType==100||buyType==110)){url=domainVar+url+params+"&tab=BUYFLACSONG"}else{url=domainVar+url+params}}}else{url=domainVar+url+params2}}else{if(buyType==3){params=params+"&changeTabTo=MP3";url=domainVar+url+params}else{if(buyType==4){params=params+"&changeTabTo=DCF";url=domainVar+url+params}else{if(buyType==5||buyType==2){params=params+"&changeTabTo=BUYSONG";url=domainVar+url+params}else{if(buyType==6){params=params+"";url=domainVar+url+params}}}}}return url},commDl:function(formName,contsId,contsType,paramsName,buyType,menuId,params){var url;var tmpName="#"+formName;var frm=$("form[name="+formName+"]");url=MELON.WEBSVC.CM.CONT.informUrl(formName,contsId,contsType,paramsName,buyType,menuId,params);if(buyType=="10"){document.location.href=url}else{var pop=window.open("","billingPopup","width=834,height=714, scrollbars=yes");frm.attr("target","billingPopup");frm.attr("action",url);frm.attr("method","post");frm.submit()}}}})();function MelOnAPIHelper(){this.LIST=Array()}MelOnAPIHelper.prototype.append=function(g,f,e,d,b,c){var a=this.LIST.length;this.LIST[a]={itemIDType:g,itemID:f,isAlbumOnly:d,statisticID:e,isFLAC16Bit:b,isFLAC24Bit:c}};MelOnAPIHelper.prototype.stringify=(function(){return JSON.stringify(this)});/* melonweb_cm.js */